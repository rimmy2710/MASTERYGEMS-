________________________________________
â­ MASTERY GEMS â€“ FINAL MASTER SPEC (V1 + Marketing Layer)
________________________________________
I. Táº¦M NHÃŒN Sáº¢N PHáº¨M
MASTERY GEMS lÃ  trÃ² chÆ¡i PvRoom cáº¡nh tranh Ä‘Ã´ng ngÆ°á»i (10â€“100 players), cÆ¡ cháº¿ Rockâ€“Paperâ€“Scissors nÃ¢ng cáº¥p vá»›i commitâ€“reveal, stake báº±ng USDC gameplay nhanh â€“ minh báº¡ch â€“ dá»… viral.
Káº¿t há»£p:
â€¢	GameFi
â€¢	Marketing referral
â€¢	NFT boost
â€¢	MG Points ecosystem (loyalty + airdrop + gamification)
â€¢	Social/KOL partnership funnel
________________________________________
II. TÃNH NÄ‚NG Cá»T LÃ•I Cá»¦A GAME
1. Loáº¡i Room
Public Room
â€¢	Ai cÅ©ng join
â€¢	Stake cá»‘ Ä‘á»‹nh: 1 USDC
â€¢	Min = 10, Max = 100
â€¢	Auto-start 30s khi Ä‘á»§ Min
Creator / VIP Room
Chá»‰ vÃ­ KOL + NFT Holder + Whitelist Ä‘Æ°á»£c táº¡o:
Loáº¡i Room	Stake	Min	Max
Creator1	1 USDC	10	100
Creator5	5 USDC	8	30
Creator10	10 USDC	6	20
________________________________________
2. Gameplay
Trong má»—i room cÃ³ sá»‘ ngÆ°á»i random tÃ¹y theo sá»‘ user Ä‘ang Online Ä‘á»ƒ ghÃ©p cáº·p, VÃ¬ váº­y trong má»—i game sáº½ cÃ³ nhá»¯ng vÃ²ng lÆ°á»£t ngÆ°á»i chÆ¡i láº» ( Lucky users) â€“ Lucky users nÃ y sáº½ Ä‘Æ°á»£c may máº¯n xáº¿p tháº¯ng táº¡i vÃ²ng loáº¡i vÃ  vÃ o tráº¡ng thÃ¡i chá» vÃ²ng tiáº¿p theo. User sá»Ÿ há»¯u NFT sáº½ tÄƒng 10% trá»Ÿ thÃ nh lucky users má»—i vÃ²ng
Best-of-3 (vÃ²ng loáº¡i)
Best-of-5 (vÃ²ng chung káº¿t / special event)
Äiá»ƒm má»—i round:
â€¢	Win = 5
â€¢	Lose = 0
â€¢	Draw (5 láº§n trá»Ÿ lÃªn):
o	NgÆ°á»i MG Points cao hÆ¡n â†’ 1.5
o	NgÆ°á»i tháº¥p hÆ¡n â†’ 1
Anti-Cheat
Commit â†’ Reveal â†’ Auto Random â†’ Auto Lock
Replay Round
Replay tá»‘i Ä‘a 5 láº§n khi gáº·p lá»—i backend.
________________________________________
3. Payout
â€¢	Top 1 â†’ 50% pool
â€¢	Top 2 â†’ 30%
â€¢	Top 3 â†’ 5%
â€¢	Top 4 â†’ 5%
â€¢	Fee dev â†’ 10%
________________________________________
4. Token Ä‘Æ°á»£c há»— trá»£
â€¢	USDC Solana
â€¢	USDC Monad
â€¢	Há»— trá»£ multi-chain join + settle á»Ÿ Monad
________________________________________
III. MARKETING LAYER â€“ USER PROFILE SYSTEM (NEW)
ÄÃ‚Y LÃ€ Bá»” SUNG QUAN TRá»ŒNG & CHÃNH THá»¨C thuá»™c core system:
________________________________________
1. User Profile
Má»—i user cÃ³ há»“ sÆ¡ cÃ¡ nhÃ¢n gá»“m:
â€¢	VÃ­ liÃªn káº¿t (Sol + Monad)
â€¢	Username
â€¢	Avatar
â€¢	Tá»•ng sá»‘ tráº­n
â€¢	Winrate
â€¢	Tá»•ng MG Points
â€¢	NFT sá»Ÿ há»¯u
â€¢	Token há»‡ thá»‘ng há» hold
â€¢	Referral Code (auto generate)
â€¢	Social (Twitter/X, Discord, Telegram)
________________________________________
2. Referral System (tá»± táº¡o khi liÃªn káº¿t vÃ­)
â€¢	User cÃ³ referral link:
/ref/<address>
â€¢	NgÆ°á»i má»i nháº­n:
o	MG Points
o	% nhá» fee hoáº·c pháº§n thÆ°á»Ÿng event
o	Cáº¥p báº­c referral leaderboard (phase 2)
________________________________________
3. Social Connect â€“ KOL Program
LiÃªn káº¿t vá»›i cÃ¡c máº¡ng:
â€¢	Twitter/X API
â€¢	Discord
â€¢	Telegram
â€¢	TikTok (optional)
Má»¥c tiÃªu:
â€¢	Nháº­n diá»‡n KOL
â€¢	Gáº¯n role â€œCreator Room Accessâ€
â€¢	LÃªn whitelist tá»± Ä‘á»™ng
â€¢	TÃ­ch há»£p campaign theo Ä‘á»‘i tÃ¡c
________________________________________
IV. MG POINTS SYSTEM (NEW)
1. MG Points dÃ¹ng Ä‘á»ƒ lÃ m gÃ¬?
â€¢	TÃ­nh Ä‘iá»ƒm tie-break khi hÃ²a quÃ¡ 5 láº§n.
â€¢	DÃ¹ng cho airdrop future token.
â€¢	D dÃ¹ng Ä‘á»ƒ claim thÆ°á»Ÿng phá»¥, má»Ÿ rÆ°Æ¡ng, váº­t pháº©m.
â€¢	DÃ¹ng lÃ m chá»‰ sá»‘ leaderboard (song song vá»›i winrate).
â€¢	DÃ¹ng trong loyalty system & Ä‘á»‘i tÃ¡c.
________________________________________
2. CÃ¡ch nháº­n MG Points
Hoáº¡t Ä‘á»™ng	MG Points
Tháº¯ng tráº­n	+3
Tháº¯ng Top1 BO3/BO5	+10
Referral active	+5
Giá»¯ NFT há»‡ thá»‘ng	boost +5% â€“ 30%
Giá»¯ token há»‡ thá»‘ng	+X% theo tier
Event KOL	+10â€“100
HoÃ n thÃ nh daily mission	+1â€“5
________________________________________
3. NFT Boost Rule (NEW)
Náº¿u user giá»¯ NFT há»‡ thá»‘ng â†’ há» cÃ³:
+10% kháº£ nÄƒng Ä‘Æ°á»£c chá»n lÃ m user may máº¯n
â†’ pass vÃ²ng loáº¡i Ä‘á»ƒ lÃªn vÃ²ng tiáº¿p theo (tÃ­nh khi phÃ²ng quÃ¡ táº£i).
â€¢	Chá»‰ backend xá»­ lÃ½
â€¢	KhÃ´ng náº±m trÃªn contract
â€¢	TÃ­nh theo tá»· lá»‡:
base_chance = 1 / total_players
if user.hasNFT:
   chance = base_chance * 1.1
________________________________________
4. Top1 Bonus Reward (NEW)
User Top1 sáº½ nháº­n:
â€¢	USDC payout
â€¢	Random MG Chest
o	50â€“100 Ä‘iá»ƒm MG
o	hoáº·c item / NFT event
Backend chá»‹u trÃ¡ch nhiá»‡m random & gá»­i káº¿t quáº£ Ä‘áº¿n user.
________________________________________
5. Claim System (NEW)
User cÃ³ thá»ƒ claim MG Points theo:
â€¢	NFT há» sá»Ÿ há»¯u
â€¢	Sá»‘ lÆ°á»£ng token há»‡ thá»‘ng há» náº¯m giá»¯
â€¢	Partner NFT/Token
â€¢	Campaign Marketing
________________________________________
V. PHÃ‚N CHIA GIAI ÄOáº N (NEW)
Giai Ä‘oáº¡n 1 â€“ MVP Functional Core (tá»‘i giáº£n nhÆ°ng cháº¡y Ä‘Æ°á»£c)
Chá»‰ táº­p trung vÃ o:
â€¢	Backend room + round engine
â€¢	Commitâ€“reveal
â€¢	Payout
â€¢	Smart contract cÆ¡ báº£n
â€¢	UI lobby + battle
â€¢	Cháº¡y testnet + test load nhá»
KhÃ´ng bao gá»“m MG Points, user profile, referral, NFT logic.
â†’ Má»¥c tiÃªu: Hoáº¡t Ä‘á»™ng mÆ°á»£t â€“ á»•n Ä‘á»‹nh â€“ khÃ´ng bug â€“ chÆ¡i tháº­t Ä‘Æ°á»£c.
________________________________________
Giai Ä‘oáº¡n 2 â€“ Growth Layer / Marketing Layer
ThÃªm cÃ¡c tÃ­nh nÄƒng má»Ÿ rá»™ng:
â€¢	User Profile Page
â€¢	Referral System
â€¢	Social Connect
â€¢	MG Points System
â€¢	NFT Boost
â€¢	Claim System
â€¢	Leaderboard full
â€¢	Creator room event boost
â€¢	Cross-chain dashboard
â€¢	BD / Partner Integrations
â†’ Má»¥c tiÃªu: tÄƒng trÆ°á»Ÿng ngÆ°á»i dÃ¹ng & kÃ­ch hoáº¡t Ä‘á»‘i tÃ¡c.
________________________________________
VI. Tá»”NG Káº¾T KIáº¾N TRÃšC Há»† THá»NG (UPDATED)
Frontend (Next.js)
  â†“ REST API
Backend (Fastify)
  - Room Engine (GÄ1)
  - Game Engine (GÄ1)
  - Chain Adapter (GÄ1)
  - User Profile (GÄ2)
  - Social Connect (GÄ2)
  - MG Points Engine (GÄ2)
  - NFT Boost Logic (GÄ2)
  â†“
Smart Contract (MoneyGameRooms.sol)
  - createRoom
  - joinRoom
  - settleGame
  - payout
  â†“
USDC Token (Solana + Monad)
________________________________________
VII. PHÃ‚N Bá»” TASK FULL â€“ THEO MODULE (FINAL)
________________________________________
ğŸ”µ GIAI ÄOáº N 1 (MVP CORE)
Backend (GÄ1)
â€¢	Core Fastify server
â€¢	Room manager (public + creator)
â€¢	Creator room stake 1/5/10
â€¢	Join/Leave room
â€¢	Commitâ€“reveal logic
â€¢	Random AFK logic
â€¢	Replay logic
â€¢	Point system
â€¢	Ranking engine
â€¢	settleGame() call
â€¢	Handle token USDC Sol + USDC Monad
Frontend (GÄ1)
â€¢	Lobby public
â€¢	Lobby VIP
â€¢	Battle page commit/reveal
â€¢	Countdown timers
â€¢	Result summary
â€¢	Wallet connect (Sol + Monad)
â€¢	Join room UI + transaction flow
Smart Contract (GÄ1)
â€¢	Room struct
â€¢	Stake 1/5/10
â€¢	joinRoom (transferFrom)
â€¢	settleGame
â€¢	payout 50/30/5/5
â€¢	fee 10% dev
â€¢	event emit
â€¢	deploy testnet
________________________________________
ğŸ”µ GIAI ÄOáº N 2 (Marketing Growth Layer)
Backend (GÄ2)
â€¢	User profile model
â€¢	Authentication wallet
â€¢	Referral generator
â€¢	Social connect API
â€¢	MG Points engine
â€¢	Claim logic
â€¢	NFT Boost logic
â€¢	Lucky user progression logic
â€¢	Top1 bonus chest generator
â€¢	Partner/NFT/Token integration module
Frontend (GÄ2)
â€¢	Profile page
â€¢	Referral dashboard
â€¢	Social link UI
â€¢	MG Points dashboard
â€¢	Claim UI
â€¢	NFT inventory
â€¢	Chest reward animation
Smart Contract (GÄ2) (náº¿u cáº§n)
â€¢	Optional NFT reward
â€¢	Optional MG Point ledger (off-chain recommended)
â€¢	Optional staking module
________________________________________
VIII. CHECKLIST CUá»I CÃ™NG â€“ Má»¨C Sáº¢N PHáº¨M
Sáº£n pháº©m cuá»‘i V1 (GÄ1) pháº£i Ä‘áº¡t:
â€¢	Public room 100 ngÆ°á»i hoáº¡t Ä‘á»™ng
â€¢	Creator room 1â€“5â€“10 USDC
â€¢	Commitâ€“reveal cháº¡y mÆ°á»£t
â€¢	Payout Ä‘Ãºng 100%
â€¢	Wallet connect cháº¡y
â€¢	Game real-time á»•n Ä‘á»‹nh 300â€“500 user test
Sáº£n pháº©m cuá»‘i V2 (GÄ2) pháº£i Ä‘áº¡t:
â€¢	User Profile hoÃ n chá»‰nh
â€¢	Referral Viral Loop
â€¢	MG Points há»‡ sinh thÃ¡i
â€¢	NFT Boost + Claim system
â€¢	Pháº§n thÆ°á»Ÿng Top1
â€¢	Social Onboarding
â€¢	TÃ­ch há»£p KOL/partner
â€¢	Dashboard lá»›n cho marketing & BD



â€ƒ
monadmoneygame/
  backend/
    src/
      server.ts
      routes/
        rooms.ts
        game.ts
      core/
        roomManager.ts
        gameEngine.ts
      types/
        room.ts
        game.ts
    package.json
    tsconfig.json

  frontend/
    app/
      layout.tsx
      page.tsx
      lobby/
        page.tsx
      battle/
        [id]/
          page.tsx
    lib/
      api.ts
      types.ts
      config.ts
    package.json
    next.config.mjs
    tsconfig.json

  contracts/
    contracts/
      MoneyGameRooms.sol
    hardhat.config.ts
    package.json
    tsconfig.json
â€ƒ
C. SÆ  Äá»’ KIáº¾N TRÃšC CHUYÃŠN NGHIá»†P (DRAW.IO STYLE)
Báº¡n cÃ³ thá»ƒ copy cáº¥u trÃºc dÆ°á»›i vÃ o draw.io / diagrams.net Ä‘á»ƒ váº½.
C.1. Level 1 â€“ System Overview
Nodes (hÃ¬nh chá»¯ nháº­t):
1.	User
2.	Frontend (Next.js)
3.	Backend (Fastify)
4.	Smart Contract (MoneyGameRooms)
5.	USDC Token (Monad/Solana)
Edges:
â€¢	User â†’ Frontend: â€œHTTP(S), Wallet Connect, UIâ€
â€¢	Frontend â†’ Backend: â€œREST API /rooms, /commit, /revealâ€
â€¢	Backend â†’ Smart Contract: â€œjoinRoom, settleGameâ€
â€¢	Smart Contract â†’ USDC: â€œtransferFrom, transferâ€
â€¢	Backend â†’ User (qua Frontend): â€œGame state, ranking, payout infoâ€
________________________________________
C.2. Backend Internal Architecture
Nodes:
â€¢	Fastify Server
â€¢	RoomsRoutes
â€¢	RoomManager
â€¢	GameEngine
â€¢	MonadClient (Chain Adapter)
â€¢	Config/ENV
Edges:
â€¢	Fastify Server â†’ RoomsRoutes: â€œregisterâ€
â€¢	RoomsRoutes â†’ RoomManager: â€œlistRooms, createRoom, joinRoom, getRoomStateâ€
â€¢	RoomsRoutes â†’ GameEngine: â€œcommitMove, revealMove, finalizeRound, getGameâ€
â€¢	RoomsRoutes â†’ MonadClient: â€œjoinRoomTx, settleGameTx (GÄ2)â€
â€¢	MonadClient â†’ Smart Contract
________________________________________
C.3. Frontend Architecture
Nodes:
â€¢	Next.js App
â€¢	Lobby Page
â€¢	Battle Page
â€¢	lib/api.ts
â€¢	Wallet Connector (tÆ°Æ¡ng lai)
â€¢	Backend API
Edges:
â€¢	Lobby Page â†’ api.getRooms â†’ Backend /rooms
â€¢	Battle Page â†’ api.getRoomState â†’ Backend /rooms/:id/state
â€¢	Battle Page â†’ api.commitMove â†’ Backend /rooms/:id/commit
â€¢	Battle Page â†’ api.revealMove â†’ Backend /rooms/:id/reveal
________________________________________
C.4. Contract Data Model
Nodes:
â€¢	MoneyGameRooms contract
â€¢	GameRoom struct
â€¢	Player struct
â€¢	USDC Token
â€¢	Dev Wallet
Edges:
â€¢	MoneyGameRooms â†’ GameRoom: rooms[roomId]
â€¢	GameRoom â†’ Player[]: players
â€¢	joinRoom â†’ USDC.transferFrom(player, contract)
â€¢	settleGame â†’ USDC.transfer(player, amount)
â€¢	settleGame â†’ USDC.transfer(devWallet, fee)
________________________________________
D. SPRINT PLAN CALENDAR 14â€“21 NGÃ€Y
Giáº£ Ä‘á»‹nh:
â€¢	Team: 1 BE, 1 FE, 1 SC, 1 PM
â€¢	Sprint: 3 sprint Ã— 1 tuáº§n (7 ngÃ y), tá»•ng 21 ngÃ y
Sprint 1 (NgÃ y 1â€“7): Skeleton & Flow CÆ¡ Báº£n
Goal: cháº¡y Ä‘Æ°á»£c:
â€¢	Backend /health, /rooms (mock)
â€¢	Frontend /lobby, /battle/:id hiá»ƒn thá»‹ state mock
â€¢	Contract compile + test cÆ¡ báº£n
Backend:
â€¢	[S1-BE1] Setup Fastify + TypeScript + tsconfig
â€¢	[S1-BE2] Implement /health
â€¢	[S1-BE3] Implement RoomManager + listRooms, createPublicRoom
â€¢	[S1-BE4] Implement /rooms GET + /rooms/:id/state mock
Frontend:
â€¢	[S1-FE1] Setup Next.js App Router
â€¢	[S1-FE2] Trang / + /lobby Ä‘á»c list rooms mock
â€¢	[S1-FE3] Trang /battle/[id] hiá»ƒn thá»‹ room state mock
Smart Contract:
â€¢	[S1-SC1] Setup Hardhat
â€¢	[S1-SC2] Viáº¿t MoneyGameRooms skeleton: createRoom, joinRoom, mapping rooms
â€¢	[S1-SC3] Test joinRoom + events cÆ¡ báº£n
Definition of Done S1:
â€¢	npm run dev backend ok
â€¢	npm run dev frontend, lobby & battle load Ä‘Æ°á»£c mock
â€¢	npx hardhat test cháº¡y test joinRoom pass
________________________________________
Sprint 2 (NgÃ y 8â€“14): Gameplay (commitâ€“reveal) + TÃ­nh Ä‘iá»ƒm
Goal:
â€¢	Commitâ€“reveal cháº¡y Ä‘Æ°á»£c
â€¢	GameEngine tÃ­nh Ä‘iá»ƒm Ä‘Æ¡n giáº£n
â€¢	Battle UI cÃ³ commit/reveal vÃ  hiá»ƒn thá»‹ state
Backend:
â€¢	[S2-BE1] Implement GameEngine (commitMove, revealMove, finalizeRound)
â€¢	[S2-BE2] ThÃªm API:
o	POST /rooms/:id/commit
o	POST /rooms/:id/reveal
o	POST /rooms/:id/finalize-round
â€¢	[S2-BE3] Gáº¯n GameEngine vá»›i RoomManager á»Ÿ /rooms/:id/state
Frontend:
â€¢	[S2-FE1] Hook commit/reveal tá»« Battle Page
â€¢	[S2-FE2] Hiá»ƒn thá»‹ JSON game state (debug)
â€¢	[S2-FE3] UX cÆ¡ báº£n: chá»n move, táº¡o salt, commit, reveal
Smart Contract:
â€¢	[S2-SC1] HoÃ n thiá»‡n settleGame payout 50/30/5/5 + fee 10%
â€¢	[S2-SC2] Unit test payout vá»›i 4 player
Definition of Done S2:
â€¢	CÃ³ thá»ƒ cháº¡y 1 room local, commit/reveal tá»« UI, backend tÃ­nh Ä‘iá»ƒm Ä‘Æ¡n giáº£n
â€¢	Contract settleGame test pass
________________________________________
Sprint 3 (NgÃ y 15â€“21): Room Types + Stake + Káº¿t ná»‘i contract (testnet)
Goal:
â€¢	Creator Room 1/5/10 USDC
â€¢	joinRoom káº¿t ná»‘i contract (Ã­t nháº¥t á»Ÿ layer BE â†’ contract)
â€¢	Flow end-to-end cÆ¡ báº£n (user mock â†’ pool â†’ payout testnet)
Backend:
â€¢	[S3-BE1] ThÃªm createCreatorRoom + API /rooms/create
â€¢	[S3-BE2] ThÃªm stake 1/5/10 vÃ o room state
â€¢	[S3-BE3] ThÃªm MonadClient skeleton (chá»‰ giáº£ láº­p / hoáº·c real testnet)
â€¢	[S3-BE4] Gáº¯n joinRoom backend vá»›i contract.joinRoom (mock tx hash náº¿u cáº§n)
Frontend:
â€¢	[S3-FE1] UI táº¡o Creator Room (chá»n stake 1/5/10)
â€¢	[S3-FE2] Hiá»ƒn thá»‹ stake & loáº¡i room trong lobby
â€¢	[S3-FE3] Chuáº©n bá»‹ chá»— Ä‘á»ƒ sau nÃ y gáº¯n wallet connect (GÄ2)
Smart Contract:
â€¢	[S3-SC1] Deploy contract lÃªn testnet Monad
â€¢	[S3-SC2] Cáº­p nháº­t Ä‘á»‹a chá»‰ contract vÃ  USDC vÃ o ENV backend
â€¢	[S3-SC3] Test manual: gá»i joinRoom + settleGame báº±ng script
Definition of Done S3:
â€¢	Tá»« UI cÃ³ thá»ƒ:
o	Xem room
o	Táº¡o Creator Room (mock user)
o	Join room (Ã­t nháº¥t gá»i Ä‘Æ°á»£c BE â†’ contract joinRoom mock/real)
o	Cháº¡y commitâ€“reveal Ä‘Æ¡n giáº£n vÃ  manual settleGame (báº±ng script)


